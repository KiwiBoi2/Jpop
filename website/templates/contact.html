{% extends "template.html" %} {% block title%}Contact Us{% endblock %}

{% block content %}
<h1 align=center>Contact</h1>

<ul class="list-group list-group-flush" id="notes">
    {% for note in user.notes %}
    <li class="list-group-item note-item">
        <div class="note-content">
            {{ note.data }}
            <div class="note-actions">
                <button class="btn btn-sm btn-secondary edit-btn" onclick="editNote({{ note.id }}, '{{ note.data }}')">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger delete-btn" onclick="deleteNote({{ note.id }})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </li>
    {% endfor %}
</ul>

<form method="POST">
    <textarea name="note" id="note" class="form-control"></textarea>
    <br/>
    <div align="center">
        <button class="btn btn-primary" type="submit">Add Comment</button>
    </div>
</form>

<script>
function deleteNote(noteId) {
    if (confirm('Are you sure you want to delete this note?')) {
        fetch(`/delete-note/${noteId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('Failed to delete note');
            }
        }).catch(error => {
            console.error('Error:', error);
            alert('Error deleting note');
        });
    }
}

function editNote(noteId, currentContent) {
    const newContent = prompt('Edit your note:', currentContent);
    if (newContent && newContent !== currentContent) {
        fetch(`/edit-note/${noteId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ content: newContent })
        }).then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('Failed to edit note');
            }
        }).catch(error => {
            console.error('Error:', error);
            alert('Error editing note');
        });
    }
}
</script>
{% endblock %}